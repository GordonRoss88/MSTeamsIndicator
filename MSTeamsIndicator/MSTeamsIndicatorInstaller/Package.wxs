<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:util="http://wixtoolset.org/schemas/v4/wxs/util"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">

   <Package
     Name="MSTeamsIndicator"
     Manufacturer="Crorosys"
     Version="1.1.0"
     UpgradeCode="639788cd-1eee-45d5-9a8d-1df75017b321">

      <MajorUpgrade DowngradeErrorMessage="A newer version is already installed." />
      <MediaTemplate EmbedCab="yes" />

      <!-- ===================== -->
      <!-- DIRECTORY STRUCTURE -->
      <!-- ===================== -->

      <StandardDirectory Id="ProgramFiles64Folder">
         <Directory Id="INSTALLDIR" Name="MSTeamsIndicator">
            <Component Id="ServiceComponent" Guid="*">

               <!-- Service executable -->
               <File Source="..\MSTeamsIndicator\bin\Release\net10.0\Publish\MSTeamsIndicator.exe" KeyPath="yes" />
               <File Source="..\MSTeamsIndicator\bin\Release\net10.0\Publish\appsettings.json" />
               

               <!-- Install Windows Service -->
               <ServiceInstall
                 Id="MSTeamsIndicator"
                 Name="MSTeamsIndicator"
                 DisplayName="MSTeamsIndicator"
                 Description="Detects Microsoft Teams calls and controls serial devices"
                 Start="auto"
                 Type="ownProcess"
                 ErrorControl="normal"
                 Account="LocalSystem" />

               <!-- Control Service -->
               <ServiceControl
                 Id="StartService"
                 Name="MSTeamsIndicator"
                 Start="install"
                 Stop="both"
                 Remove="uninstall"
                 Wait="yes" />
            </Component>

         </Directory>
      </StandardDirectory>

      <!-- ===================== -->
      <!-- FEATURE -->
      <!-- ===================== -->

      <Feature Id="MainFeature" Title="MSTeamsIndicator" Level="1">
         <ComponentRef Id="ServiceComponent" />
      </Feature>
   </Package>
</Wix>